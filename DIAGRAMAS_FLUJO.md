# ğŸ”„ Diagramas de Flujo TÃ©cnicos - Q'Tal Lisura

## ğŸ“‹ Ãndice
1. [Arquitectura General](#arquitectura-general)
2. [Flujo de AutenticaciÃ³n](#flujo-de-autenticaciÃ³n)
3. [Flujo de Reservas](#flujo-de-reservas)
4. [Flujo de GestiÃ³n de Productos](#flujo-de-gestiÃ³n-de-productos)
5. [Ciclo de Vida de una Reserva](#ciclo-de-vida-de-una-reserva)
6. [InteracciÃ³n Frontend-Backend](#interacciÃ³n-frontend-backend)

---

## 1. Arquitectura General

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          CLIENTE (Navegador)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  HTML (Thymeleaf)  â”‚  CSS (Bootstrap 5)  â”‚  JS (Vanilla)           â”‚
â”‚  â”œâ”€ cliente/       â”‚  â”œâ”€ styles.css      â”‚  â”œâ”€ catalogo.js         â”‚
â”‚  â”œâ”€ admin/         â”‚  â”œâ”€ cliente.css     â”‚  â”œâ”€ productos.js        â”‚
â”‚  â””â”€ auth/          â”‚  â””â”€ admin.css       â”‚  â”œâ”€ reservas-cliente.js â”‚
â”‚                    â”‚                      â”‚  â””â”€ reservas-admin.js   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ HTTP/HTTPS
                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       SPRING BOOT APPLICATION                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚                    CONTROLLERS                          â”‚        â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚        â”‚
â”‚  â”‚  â”‚ HomeCtrl     â”‚ AuthCtrl     â”‚ AdminCtrl       â”‚    â”‚        â”‚
â”‚  â”‚  â”‚ (Vistas)     â”‚ (/api/auth)  â”‚ (Vistas Admin)  â”‚    â”‚        â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚        â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚        â”‚
â”‚  â”‚  â”‚         REST Controllers (API)               â”‚     â”‚        â”‚
â”‚  â”‚  â”‚  /producto  /categoria  /mesa  /reserva     â”‚     â”‚        â”‚
â”‚  â”‚  â”‚  /usuario   /perfil     /cliente            â”‚     â”‚        â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                        â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚                   SERVICES                          â”‚           â”‚
â”‚  â”‚  - ProductoService     - MesaService                â”‚           â”‚
â”‚  â”‚  - CategoriaService    - ReservaService             â”‚           â”‚
â”‚  â”‚  - UsuarioService      - FileStorageService         â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                        â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚                 REPOSITORIES (JPA)                  â”‚           â”‚
â”‚  â”‚  - ProductoRepository  - MesaRepository             â”‚           â”‚
â”‚  â”‚  - CategoriaRepository - ReservaRepository          â”‚           â”‚
â”‚  â”‚  - UsuarioRepository   - ClienteRepository          â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                        â”‚                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ JDBC
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        BASE DE DATOS                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ producto â”‚categoria â”‚   mesa   â”‚ reserva  â”‚ usuario  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SISTEMA DE ARCHIVOS                             â”‚
â”‚  uploads/                                                            â”‚
â”‚  â”œâ”€ products/  (ImÃ¡genes de productos)                              â”‚
â”‚  â””â”€ users/     (Avatares de usuarios)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Flujo de AutenticaciÃ³n

### 2.1 Login de Administrador

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario â”‚
â”‚  Admin  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 1. Accede a /auth/admin
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LoginForm    â”‚
â”‚ - username   â”‚
â”‚ - password   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. Submit form
       â”‚    cliente.js â†’ loginAdmin()
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ fetch('/api/auth/login', {          â”‚
â”‚   method: 'POST',                   â”‚
â”‚   body: JSON.stringify({            â”‚
â”‚     username: "admin",              â”‚
â”‚     password: "pass123"             â”‚
â”‚   })                                â”‚
â”‚ })                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ 3. HTTP POST
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AuthController.login()                      â”‚
â”‚                                             â”‚
â”‚ 1. Busca usuario en DB                      â”‚
â”‚    usuarioRepository.findByUsername()       â”‚
â”‚                                             â”‚
â”‚ 2. Valida contraseÃ±a                        â”‚
â”‚    passwordEncoder.matches(...)             â”‚
â”‚                                             â”‚
â”‚ 3. Crea sesiÃ³n HTTP                         â”‚
â”‚    session.setAttribute("usuarioLogueado")  â”‚
â”‚    session.setAttribute("idUsuario")        â”‚
â”‚    session.setAttribute("perfilUsuario")    â”‚
â”‚                                             â”‚
â”‚ 4. Retorna respuesta JSON                   â”‚
â”‚    {                                        â”‚
â”‚      success: true,                         â”‚
â”‚      perfil: "ADMINISTRADOR",               â”‚
â”‚      redirectUrl: "/admin/dashboard"        â”‚
â”‚    }                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ 4. Response 200 OK
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ JavaScript recibe respuesta         â”‚
â”‚                                     â”‚
â”‚ if (data.success) {                 â”‚
â”‚   sessionStorage.setItem(...)       â”‚
â”‚   window.location.href =            â”‚
â”‚     data.redirectUrl                â”‚
â”‚ }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ 5. RedirecciÃ³n
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /admin/dashboard    â”‚
â”‚                     â”‚
â”‚ âœ… Usuario          â”‚
â”‚    Autenticado      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 VerificaciÃ³n de SesiÃ³n

```
Cliente carga /admin/productos
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Spring Security Filter  â”‚
â”‚ o Interceptor           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
      Â¿SesiÃ³n vÃ¡lida?
           â”‚
     â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
     â”‚           â”‚
    SÃ          NO
     â”‚           â”‚
     â–¼           â–¼
  Permite    Redirecciona
  acceso     a /auth/admin
```

---

## 3. Flujo de Reservas

### 3.1 Cliente Crea Reserva

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cliente â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ 1. Accede a /reservas
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ reservas-cliente.js carga  â”‚
â”‚                            â”‚
â”‚ DOMContentLoaded           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€ 2a. cargarMesasDisponibles()
          â”‚      â–¼
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  â”‚ GET /mesa              â”‚
          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚            â”‚
          â”‚            â–¼
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  â”‚ Filter: estadoMesa='DISPONIBLE'â”‚
          â”‚  â”‚         estadoBD='ACTIVO'      â”‚
          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚            â”‚
          â”‚            â–¼
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  â”‚ mesasDisponibles = [...] â”‚
          â”‚  â”‚ actualizarSelectMesas()â”‚
          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â””â”€ 2b. setMinFechaHora()
                 â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ fecha min = hoy + 1h   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Usuario llena formulario
     â”‚
     â”‚ - Nombre: "Juan PÃ©rez"
     â”‚ - TelÃ©fono: "987654321"
     â”‚ - Fecha: "2026-02-15"
     â”‚ - Hora: "20:00"
     â”‚ - Personas: 4
     â”‚ - Mesa: 5 (capacidad 6)
     â”‚
     â”‚ 3. Submit formulario
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ submitReserva()            â”‚
â”‚                            â”‚
â”‚ Validaciones:              â”‚
â”‚ âœ“ Campos requeridos        â”‚
â”‚ âœ“ Fecha futura             â”‚
â”‚ âœ“ Mesa seleccionada        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ 4. POST /reserva
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ {                                â”‚
â”‚   "idCliente": null,             â”‚
â”‚   "idMesa": 5,                   â”‚
â”‚   "fechaHora": "2026-02-15T20:00",â”‚
â”‚   "cantidadPersonas": 4,         â”‚
â”‚   "telefono": "987654321",       â”‚
â”‚   "comentarios": "",             â”‚
â”‚   "estadoSolicitud": "PENDIENTE" â”‚
â”‚ }                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ReservaController.createReserva() â”‚
â”‚                                   â”‚
â”‚ 1. Valida DTO                     â”‚
â”‚ 2. reservaService.create(dto)     â”‚
â”‚    â”œâ”€ Valida disponibilidad       â”‚
â”‚    â”œâ”€ Crea entidad Reserva        â”‚
â”‚    â””â”€ Guarda en DB                â”‚
â”‚ 3. Retorna 201 Created            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ 5. Response
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend recibe 201        â”‚
â”‚                            â”‚
â”‚ showMessage(               â”‚
â”‚   "Reserva registrada",    â”‚
â”‚   "success"                â”‚
â”‚ )                          â”‚
â”‚                            â”‚
â”‚ Limpia formulario          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Admin Gestiona Reserva

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Admin  â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚ 1. Accede a /admin/reservas
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ reservas-admin.js carga     â”‚
â”‚                             â”‚
â”‚ DOMContentLoaded            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ 2a. cargarMesas()
       â”‚      GET /mesa
       â”‚      â†’ Llena filtro de mesas
       â”‚
       â””â”€ 2b. cargarReservas()
              â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ GET /reserva           â”‚
       â”‚                        â”‚
       â”‚ Retorna todas          â”‚
       â”‚ las reservas           â”‚
       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ renderReservas(reservas)  â”‚
       â”‚                           â”‚
       â”‚ Genera tabla HTML:        â”‚
       â”‚ - ID reserva              â”‚
       â”‚ - Fecha/hora              â”‚
       â”‚ - Cliente                 â”‚
       â”‚ - Mesa                    â”‚
       â”‚ - Estado                  â”‚
       â”‚ - Botones de acciÃ³n       â”‚
       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ actualizarEstadisticas()  â”‚
       â”‚                           â”‚
       â”‚ Calcula:                  â”‚
       â”‚ - Pendientes: 5           â”‚
       â”‚ - Confirmadas: 12         â”‚
       â”‚ - Canceladas: 2           â”‚
       â”‚ - Para hoy: 3             â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Admin ve reserva #123 (PENDIENTE)
     â”‚
     â”‚ 3. Click "Confirmar"
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ confirmarReserva(123)       â”‚
â”‚                             â”‚
â”‚ 1. ConfirmaciÃ³n            â”‚
â”‚    Swal.fire({              â”‚
â”‚      title: "Â¿Confirmar?"   â”‚
â”‚    })                       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Usuario confirma
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. GET /reserva/123              â”‚
â”‚    Obtiene datos actuales        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Actualiza objeto              â”‚
â”‚    reserva.estadoSolicitud =     â”‚
â”‚      "CONFIRMADA"                â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 4. PUT /reserva/123
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ReservaController.updateById()   â”‚
â”‚                                  â”‚
â”‚ 1. Busca reserva en DB           â”‚
â”‚ 2. Actualiza campos              â”‚
â”‚ 3. Guarda cambios                â”‚
â”‚ 4. Retorna 200 OK                â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 5. Response
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend actualiza               â”‚
â”‚                                  â”‚
â”‚ - Recarga tabla                  â”‚
â”‚ - Actualiza estadÃ­sticas         â”‚
â”‚ - Muestra notificaciÃ³n Ã©xito     â”‚
â”‚                                  â”‚
â”‚ Estado: PENDIENTE â†’ CONFIRMADA   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ (Futuro) Enviar notificaciÃ³n     â”‚
â”‚ - Email al cliente               â”‚
â”‚ - SMS de confirmaciÃ³n            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Flujo de GestiÃ³n de Productos

### 4.1 Admin Crea Producto

```
Admin en /admin/productos
     â”‚
     â”‚ 1. Click "Nuevo Producto"
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ openProductoModal('create') â”‚
â”‚                             â”‚
â”‚ - Limpia formulario         â”‚
â”‚ - Modal.show()              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. Usuario llena form
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ - Nombre: "Ceviche ClÃ¡sico"      â”‚
â”‚ - CategorÃ­a: "Entradas" (id: 1)  â”‚
â”‚ - DescripciÃ³n: "..."             â”‚
â”‚ - Precio Venta: 32.00            â”‚
â”‚ - Costo Unitario: 15.00          â”‚
â”‚ - Stock MÃ­nimo: 10               â”‚
â”‚ - Stock Actual: 50               â”‚
â”‚ - Imagen: [selecciona archivo]   â”‚
â”‚ - Estado: ACTIVO                 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 3. Submit form
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ saveProducto(event)             â”‚
â”‚                                 â”‚
â”‚ 1. Previene submit default      â”‚
â”‚ 2. Valida formulario            â”‚
â”‚ 3. Crea FormData                â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ const formData = new FormData()      â”‚
â”‚ formData.append('nombre', nombre)    â”‚
â”‚ formData.append('idCategoria', 1)    â”‚
â”‚ formData.append('descripcion', ...)  â”‚
â”‚ formData.append('precioVenta', 32)   â”‚
â”‚ formData.append('imagen', file)      â”‚
â”‚ ...                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 4. POST /producto
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ fetch('/producto', {                  â”‚
â”‚   method: 'POST',                     â”‚
â”‚   body: formData                      â”‚
â”‚ })                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ProductoController.createProducto()        â”‚
â”‚                                            â”‚
â”‚ @RequestParam recibe parÃ¡metros:           â”‚
â”‚ - Datos del producto                       â”‚
â”‚ - MultipartFile imagen                     â”‚
â”‚                                            â”‚
â”‚ 1. Valida imagen                           â”‚
â”‚    if (imagen != null) {                   â”‚
â”‚      fileStorageService.isValidImage()     â”‚
â”‚      fileStorageService.isValidSize()      â”‚
â”‚    }                                       â”‚
â”‚                                            â”‚
â”‚ 2. Guarda imagen                           â”‚
â”‚    imagenUrl = fileStorageService          â”‚
â”‚      .saveProductImage(imagen)             â”‚
â”‚    â†’ Genera UUID                           â”‚
â”‚    â†’ Guarda en uploads/products/           â”‚
â”‚    â†’ Retorna nombre: "product_abc123.jpg"  â”‚
â”‚                                            â”‚
â”‚ 3. Crea ProductoRequestDTO                 â”‚
â”‚    ProductoRequestDTO.builder()            â”‚
â”‚      .nombre(nombre)                       â”‚
â”‚      .imagenUrl(imagenUrl)                 â”‚
â”‚      ...                                   â”‚
â”‚      .build()                              â”‚
â”‚                                            â”‚
â”‚ 4. Llama servicio                          â”‚
â”‚    productoService.create(dto)             â”‚
â”‚    â”œâ”€ Convierte DTO â†’ Entidad              â”‚
â”‚    â”œâ”€ Asigna categorÃ­a                     â”‚
â”‚    â””â”€ Guarda en DB                         â”‚
â”‚                                            â”‚
â”‚ 5. Retorna 201 Created                     â”‚
â”‚    ResponseEntity.status(201)              â”‚
â”‚      .body(productoResponse)               â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 6. Response
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend recibe 201        â”‚
â”‚                            â”‚
â”‚ - Cierra modal             â”‚
â”‚ - Muestra notificaciÃ³n     â”‚
â”‚ - Recarga tabla productos  â”‚
â”‚   cargarProductos()        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 VisualizaciÃ³n en CatÃ¡logo PÃºblico

```
Cliente accede a /catalogo
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ catalogo.js carga           â”‚
â”‚                             â”‚
â”‚ DOMContentLoaded            â”‚
â”‚   â†’ cargarProductos()       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ GET /producto
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ProductoController.getAll()   â”‚
â”‚                               â”‚
â”‚ return productoService        â”‚
â”‚   .allList()                  â”‚
â”‚                               â”‚
â”‚ â†’ Retorna TODOS los productos â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Response: Array<Producto>
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend filtra:                 â”‚
â”‚                                  â”‚
â”‚ todosLosProductos =              â”‚
â”‚   productos.filter(p =>          â”‚
â”‚     p.estadoBD.toLowerCase()     â”‚
â”‚       === 'activo'               â”‚
â”‚   )                              â”‚
â”‚                                  â”‚
â”‚ â†’ Solo muestra ACTIVOS           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ renderizarProductos()          â”‚
â”‚                                â”‚
â”‚ Genera cards:                  â”‚
â”‚ - Imagen del producto          â”‚
â”‚ - Nombre                       â”‚
â”‚ - DescripciÃ³n                  â”‚
â”‚ - Precio                       â”‚
â”‚ - CategorÃ­a badge              â”‚
â”‚                                â”‚
â”‚ âŒ NO muestra:                 â”‚
â”‚    - BotÃ³n "Agregar carrito"   â”‚
â”‚    - Stock                     â”‚
â”‚    - Opciones de compra        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Ciclo de Vida de una Reserva

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ESTADOS DE RESERVA                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    [CLIENTE]          [ADMIN]           [SISTEMA]
        â”‚                 â”‚                   â”‚
        â”‚ Llena           â”‚                   â”‚
        â”‚ formulario      â”‚                   â”‚
        â”‚                 â”‚                   â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ POST /reserva   â”‚                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                   â”‚
                          â”‚                   â”‚
                          â–¼                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
                    â”‚PENDIENTEâ”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                         â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                           â”‚
           â”‚ Admin                     â”‚ Admin
           â”‚ confirma                  â”‚ cancela
           â”‚                           â”‚
           â–¼                           â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚CONFIRMADAâ”‚               â”‚CANCELADA â”‚
      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                          â–²
            â”‚ Cliente                  â”‚
            â”‚ asiste                   â”‚ Cliente
            â”‚                          â”‚ no llega
            â–¼                          â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
      â”‚COMPLETADAâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   TRANSICIONES VÃLIDAS                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  PENDIENTE â†’ CONFIRMADA  (Admin confirma)                   â”‚
â”‚  PENDIENTE â†’ CANCELADA   (Admin rechaza o Cliente cancela)  â”‚
â”‚  CONFIRMADA â†’ COMPLETADA (Cliente asiste)                   â”‚
â”‚  CONFIRMADA â†’ CANCELADA  (Cliente no llega / CancelaciÃ³n)   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ACCIONES POR ESTADO                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  PENDIENTE:                                                 â”‚
â”‚    âœ“ Admin puede confirmar                                  â”‚
â”‚    âœ“ Admin puede cancelar                                   â”‚
â”‚    âœ“ Mesa queda como RESERVADA (opcional)                   â”‚
â”‚                                                             â”‚
â”‚  CONFIRMADA:                                                â”‚
â”‚    âœ“ Mesa marcada como RESERVADA                            â”‚
â”‚    âœ“ Cliente recibe confirmaciÃ³n                            â”‚
â”‚    âœ“ Aparece en "Reservas de Hoy" si corresponde            â”‚
â”‚    âœ“ Admin puede completar (check-in)                       â”‚
â”‚    âœ“ Admin puede cancelar (con razÃ³n)                       â”‚
â”‚                                                             â”‚
â”‚  COMPLETADA:                                                â”‚
â”‚    âœ“ Mesa liberada (DISPONIBLE)                             â”‚
â”‚    âœ“ Se puede solicitar reseÃ±a                              â”‚
â”‚    âœ— No se puede modificar                                  â”‚
â”‚                                                             â”‚
â”‚  CANCELADA:                                                 â”‚
â”‚    âœ“ Mesa liberada (DISPONIBLE)                             â”‚
â”‚    âœ— No se puede reactivar (crear nueva reserva)            â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. InteracciÃ³n Frontend-Backend

### 6.1 PatrÃ³n de ComunicaciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FRONTEND   â”‚                           â”‚   BACKEND    â”‚
â”‚  JavaScript  â”‚                           â”‚ Spring Boot  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                          â”‚
       â”‚ 1. fetch(url, options)                   â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
       â”‚                                          â”‚
       â”‚                                          â”‚ 2. Controller
       â”‚                                          â”‚    recibe request
       â”‚                                          â”‚
       â”‚                                          â”‚ 3. Valida datos
       â”‚                                          â”‚    (@Valid)
       â”‚                                          â”‚
       â”‚                                          â”‚ 4. Service Layer
       â”‚                                          â”‚    procesa lÃ³gica
       â”‚                                          â”‚
       â”‚                                          â”‚ 5. Repository
       â”‚                                          â”‚    consulta DB
       â”‚                                          â”‚
       â”‚                                          â”‚ 6. Mapea a DTO
       â”‚                                          â”‚
       â”‚ 7. Response JSON                         â”‚
       â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                                          â”‚
       â”‚ 8. Procesa respuesta                     â”‚
       â”‚    .then(response => response.json())    â”‚
       â”‚    .then(data => { ... })                â”‚
       â”‚                                          â”‚
       â”‚ 9. Actualiza DOM                         â”‚
       â”‚    renderTabla(data)                     â”‚
       â”‚    showNotification()                    â”‚
       â”‚                                          â”‚
       â–¼                                          â–¼
```

### 6.2 Ejemplo Completo: Listar Productos

```javascript
// ============================================
// FRONTEND: productos.js
// ============================================

async function cargarProductos() {
    try {
        // 1. Realiza peticiÃ³n GET
        const response = await fetch('/producto');
        
        // 2. Verifica status code
        if (response.ok) {
            // 3. Parsea JSON
            const productos = await response.json();
            
            // 4. Actualiza estado local
            productosData = productos;
            
            // 5. Renderiza en DOM
            renderProductos(productos);
        } else {
            // Manejo de errores
            showNotification('Error al cargar productos', 'error');
        }
    } catch (error) {
        // Manejo de excepciones
        console.error('Error:', error);
        showNotification('Error de conexiÃ³n', 'error');
    }
}
```

```java
// ============================================
// BACKEND: ProductoController.java
// ============================================

@RestController
@RequestMapping("/producto")
public class ProductoController {
    
    private final ProductoService productoService;
    
    @GetMapping
    public ResponseEntity<Iterable<ProductoResponseDTO>> getAllProductos() {
        log.info("Recibida solicitud GET /producto");
        
        // 1. Llama al servicio
        Iterable<ProductoResponseDTO> productos = 
            productoService.allList();
        
        // 2. Retorna respuesta
        return ResponseEntity.ok(productos);
    }
}
```

```java
// ============================================
// BACKEND: ProductoService.java
// ============================================

@Service
public class ProductoServiceImpl implements ProductoService {
    
    private final ProductoRepository productoRepository;
    private final ProductoMapper productoMapper;
    
    @Override
    public Iterable<ProductoResponseDTO> allList() {
        // 1. Consulta repositorio
        List<Producto> productos = productoRepository.findAll();
        
        // 2. Mapea entidades a DTOs
        return productos.stream()
            .map(productoMapper::toResponseDTO)
            .collect(Collectors.toList());
    }
}
```

### 6.3 Ejemplo: Crear Producto con Imagen

```javascript
// ============================================
// FRONTEND: productos.js
// ============================================

async function saveProducto(event) {
    event.preventDefault();
    const form = event.target;
    
    // 1. Crea FormData (para archivos)
    const formData = new FormData();
    formData.append('nombre', document.getElementById('nombre').value);
    formData.append('idCategoria', document.getElementById('categoria').value);
    formData.append('descripcion', document.getElementById('descripcion').value);
    formData.append('precioVenta', document.getElementById('precio').value);
    formData.append('costoUnitario', document.getElementById('costo').value);
    formData.append('stockMinimo', document.getElementById('stockMin').value);
    formData.append('stockActual', document.getElementById('stockActual').value);
    formData.append('estadoBD', document.getElementById('estado').value);
    
    // 2. Agrega archivo si existe
    const imagenInput = document.getElementById('imagen');
    if (imagenInput.files[0]) {
        formData.append('imagen', imagenInput.files[0]);
    }
    
    try {
        // 3. POST con FormData (no JSON)
        const response = await fetch('/producto', {
            method: 'POST',
            body: formData  // NO headers, el navegador los agrega automÃ¡ticamente
        });
        
        if (response.ok) {
            const data = await response.json();
            showNotification('Producto creado', 'success');
            productoModal.hide();
            cargarProductos();  // Recarga lista
        }
    } catch (error) {
        showNotification('Error', 'error');
    }
}
```

```java
// ============================================
// BACKEND: ProductoController.java
// ============================================

@PostMapping
public ResponseEntity<ProductoResponseDTO> createProducto(
    @Valid @RequestParam("idCategoria") Integer idCategoria,
    @Valid @RequestParam("nombre") String nombre,
    @Valid @RequestParam("descripcion") String descripcion,
    @Valid @RequestParam("precioVenta") Double precioVenta,
    @Valid @RequestParam("costoUnitario") Double costoUnitario,
    @Valid @RequestParam("stockMinimo") Integer stockMinimo,
    @Valid @RequestParam("stockActual") Integer stockActual,
    @RequestParam(value = "imagen", required = false) MultipartFile imagen,
    @Valid @RequestParam(value = "estadoBD", defaultValue = "ACTIVO") EstadoBD estadoBD
) {
    log.info("Creando nuevo producto");
    
    // 1. Procesa imagen si existe
    String imagenUrl = null;
    if (imagen != null && !imagen.isEmpty()) {
        // Valida formato
        if (!fileStorageService.isValidImage(imagen)) {
            return ResponseEntity.badRequest().build();
        }
        // Valida tamaÃ±o
        if (!fileStorageService.isValidSize(imagen)) {
            return ResponseEntity.badRequest().build();
        }
        // Guarda archivo
        imagenUrl = fileStorageService.saveProductImage(imagen);
    }
    
    // 2. Construye DTO
    ProductoRequestDTO dto = ProductoRequestDTO.builder()
        .idCategoria(idCategoria)
        .nombre(nombre)
        .descripcion(descripcion)
        .precioVenta(precioVenta)
        .costoUnitario(costoUnitario)
        .stockMinimo(stockMinimo)
        .stockActual(stockActual)
        .imagenUrl(imagenUrl)
        .estadoBD(estadoBD)
        .build();
    
    // 3. Llama servicio
    ProductoResponseDTO response = productoService.create(dto);
    
    // 4. Retorna 201 Created
    return ResponseEntity.status(201).body(response);
}
```

---

## ğŸ“ Resumen de Patrones

### âœ… Buenas PrÃ¡cticas Implementadas

1. **SeparaciÃ³n de Capas**
   ```
   Controller â†’ Service â†’ Repository â†’ Database
   ```

2. **DTOs para ComunicaciÃ³n**
   ```
   Entity â†” Service â†” DTO â†” Controller â†” JSON â†” Frontend
   ```

3. **Async/Await en Frontend**
   ```javascript
   async function cargarDatos() {
       const response = await fetch(url);
       const data = await response.json();
       renderizar(data);
   }
   ```

4. **Manejo de Errores**
   ```javascript
   try { ... } catch (error) {
       showNotification('Error', 'error');
   }
   ```

5. **ValidaciÃ³n en Ambos Lados**
   - Frontend: HTML5 validation + JS
   - Backend: `@Valid` + custom validators

---

**ğŸ“Š Diagramas TÃ©cnicos - Q'Tal Lisura**  
*VersiÃ³n 1.0 - Febrero 2026*

